<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8' />
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <title>Mini MQTT over websocket</title>

  <link rel='icon' href='data:image/png;base64,' />
  <link rel='stylesheet' crossorigin='anonymous' href='https://cdn.jsdelivr.net/npm/shoelace-css@1.0.0-beta24/dist/shoelace.css' />
  <style>main { max-width: 40em; margin: 2em auto; }</style>

</head>

<body>
<main>
  <h1>u8-mqtt</h1>

  <a href='./demo/demo_web.html'><h3>Demo MQTT Web Client</h3></a>
  <a href='./demo/demo_web_tiny.html'><h3>Demo Tiny MQTT Web Client</h3></a>

  <p><i>Look in the developer console</i></p>
</main>

<script type=module>
//import MQTTClient from 'u8-mqtt/esm/client/web.mjs'
//import MQTTClient from './esm/client/web.mjs'
import MQTTClient from './esm/client/web.min.mjs'

const my_mqtt = new MQTTClient()

my_mqtt.router
  .add('u8-mqtt-demo/topic/:arg', (kw, pkt) => {
    console.log('topic:', kw, [kw.arg, pkt.utf8()])
  })
  .add('u8-mqtt-demo/another/:first/:second', (kw, pkt) => {
    console.log('another:', kw, [kw.first, kw.second, pkt.utf8()])
  })


// or connect using WebSockets
my_mqtt.with_websock('ws://127.0.0.1:9001')
  .then(somewhere_in_your_code)
  

// ...
async function somewhere_in_your_code() {

  await my_mqtt.connect({
    client_id: 'u8-mqtt-demo-web',
    will: {
      topic: 'u8-mqtt-demo/bye',
      payload: 'gone!',
    }
  })

  await my_mqtt.subscribe([
    'u8-mqtt-demo/another/#',
    'u8-mqtt-demo/topic/+',
    'u8-mqtt-demo/bye',
  ])

  my_mqtt.publish({
    topic: 'u8-mqtt-demo/topic/web-side-fun-test',
    payload: 'awesome from both web and node',
  })

  my_mqtt.send(
    'u8-mqtt-demo/another/pineapple/mango',
    'Web-side Fruity fun')

}
</script>
